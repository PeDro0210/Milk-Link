<script lang="ts">
  import Separator from "./components/separator.svelte";
  import TaskbarButtons from "./components/taskbar_buttons.svelte";
  import { type TaskbarButton } from "./utils/interfaces";
  import {
    icon_placeholder_url,
    start_button_attributes,
  } from "./utils/constant";
  import TaskbarClock from "./components/taskbar_clock.svelte";
  import { onMount } from "svelte";

  //TODO: manage all the reactivity in here

  //Global Constant
  let global_innerWidth = window.innerWidth - 350 + "px";

  //The reactivity GRAWWWWWW
  let time: Date = $state(new Date());
  let _innerWidth = $state("");

  let windowResizing = (width: string) => {
    let window_side = document.querySelector(".windows-side") as HTMLElement;
    window_side.style.setProperty("--window-width", _innerWidth);
  };

  onMount(() => {
    _innerWidth = window.innerWidth - 350 + "px";
    windowResizing(_innerWidth);
  });

  //Managing the date for the clock
  $effect(() => {
    setInterval(() => {
      time = new Date();
      console.log(time);
    }, 6000);
  });

  //His is still not the best option, is a pretty inscure way to managing the DOM
  //Managing the resizing of the window-sidebar
  $effect(() => {
    const updateWidth = () => {
      _innerWidth = window.innerWidth - 350 + "px"; // Adjust the width calculation as needed
      windowResizing(_innerWidth);
    };

    window.addEventListener("resize", updateWidth);
  });

  //! This is mostly debugging code

  let dummy_window_buttons: TaskbarButton[] = [];

  let window_buttons: TaskbarButton = {
    icon: icon_placeholder_url,
    text: null,
    width: null,
  };

  for (let i = 0; i <= 10; i++) {
    dummy_window_buttons.push(window_buttons);
  }
</script>

<div id="taskbar">
  <TaskbarButtons
    icon_url={icon_placeholder_url}
    width={start_button_attributes.width}
    text={start_button_attributes.text}
  />

  <Separator />

  <div class="windows-side">
    <!--TODO: Change the list to the real deal-->
    {#each dummy_window_buttons as button}
      <TaskbarButtons
        icon_url={button.icon}
        width={button.width}
        text={button.text}
      />
    {/each}
  </div>

  <Separator />

  <TaskbarClock {time} />
</div>

<style lang="scss">
  #taskbar {
    /* Auto layout */
    display: flex;
    flex-direction: row;
    align-items: center;

    padding: 10px 10px;
    gap: 13px;

    position: relative;
    width: 100%;
    height: 56px;

    pointer-events: auto;
    scroll-behavior: auto;

    background: #0e0f14;
    box-shadow: 4px 4px 4px rgba(0, 0, 0, 0.25);
  }

  #windows-side {
    /* Auto layout */
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 0px;
    gap: 10px;

    overflow-x: auto;
    scrollbar-width: 1px;

    width: var(--window-width, 80%);
    width: var(--window-width, 0);

    /* Inside auto layout */
    flex: none;
    order: 1;
    flex-grow: 0;
  }
</style>
